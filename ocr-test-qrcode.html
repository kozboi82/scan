<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <title>ì§„ì§œ ë°”ì½”ë“œ ìµœì í™” ìŠ¤ìºë„ˆ (ìˆ˜ì •íŒ)</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { 
            font-family: sans-serif; 
            padding: 10px;
            margin: 0;
            background: #f0f0f0;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }
        
        h2 { 
            color: #333; 
            text-align: center;
            margin-bottom: 10px;
        }
        
        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .info-box strong {
            color: #1976d2;
        }
        
        #reader { 
            width: 100%;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            min-height: 300px;
        }
        
        .settings {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .setting-row label {
            flex: 1;
            font-size: 14px;
        }
        
        .setting-row select {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        #result {
            margin-top: 20px;
            padding: 15px;
            background: #d4edda;
            border-radius: 8px;
            display: none;
        }
        
        #result.show {
            display: block;
        }
        
        .debug {
            margin-top: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .btn {
            padding: 12px 24px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: #1976d2;
        }
        
        .btn.start {
            background: #4caf50;
        }
        
        .btn.start:hover {
            background: #45a049;
        }
        
        .btn.stop {
            background: #f44336;
        }
        
        .btn.stop:hover {
            background: #da190b;
        }
        
        .status-indicator {
            padding: 10px;
            text-align: center;
            border-radius: 6px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .status-indicator.ready {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-indicator.scanning {
            background: #cce5ff;
            color: #004085;
        }
        
        .status-indicator.stopped {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ”¬ ì§„ì§œ ë°”ì½”ë“œ ìµœì í™” ìŠ¤ìºë„ˆ</h2>
        
        <div class="info-box">
            <strong>ì‚¬ìš©ë²•:</strong><br>
            1. ì„¤ì • ì„ íƒ (í¬ë§·, FPS, í•´ìƒë„)<br>
            2. "ìŠ¤ìºë„ˆ ì‹œì‘" ë²„íŠ¼ í´ë¦­<br>
            3. ì¹´ë©”ë¼ ê¶Œí•œ í—ˆìš©<br>
            4. QR/ë°”ì½”ë“œë¥¼ ì¹´ë©”ë¼ì— ë¹„ì¶”ê¸°
        </div>
        
        <div id="statusIndicator" class="status-indicator ready">
            ğŸ“· ì¤€ë¹„ë¨ - ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”
        </div>
        
        <!-- ì‹¤ì œ íš¨ê³¼ê°€ ìˆëŠ” ì„¤ì •ë“¤ -->
        <div class="settings">
            <h3>âš™ï¸ ì‹¤ì œ íš¨ê³¼ê°€ ìˆëŠ” ì„¤ì •</h3>
            
            <div class="setting-row">
                <label>ìŠ¤ìº” í¬ë§· (ì§„ì§œ íš¨ê³¼ âœ…)</label>
                <select id="formatSelect">
                    <option value="all">ëª¨ë“  í¬ë§·</option>
                    <option value="qr">QR ì½”ë“œë§Œ</option>
                    <option value="barcode">ë°”ì½”ë“œë§Œ</option>
                    <option value="code128">CODE-128ë§Œ</option>
                    <option value="ean">EAN-13/8ë§Œ</option>
                </select>
            </div>
            
            <div class="setting-row">
                <label>ìŠ¤ìº” ì†ë„ FPS (ì§„ì§œ íš¨ê³¼ âœ…)</label>
                <select id="fpsSelect">
                    <option value="5">5 FPS (ë°°í„°ë¦¬ ì ˆì•½)</option>
                    <option value="10" selected>10 FPS (ê· í˜•)</option>
                    <option value="15">15 FPS (ë¹ ë¥¸ ì¸ì‹)</option>
                    <option value="30">30 FPS (ìµœëŒ€ ì„±ëŠ¥)</option>
                </select>
            </div>
            
            <div class="setting-row">
                <label>ì¹´ë©”ë¼ í•´ìƒë„ (ì§„ì§œ íš¨ê³¼ âœ…)</label>
                <select id="resolutionSelect">
                    <option value="low">ë‚®ìŒ (640x480)</option>
                    <option value="medium" selected>ì¤‘ê°„ (1280x720)</option>
                    <option value="high">ë†’ìŒ (1920x1080)</option>
                </select>
            </div>
        </div>
        
        <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
        <button id="startBtn" class="btn start" onclick="startScanner()">
            â–¶ï¸ ìŠ¤ìºë„ˆ ì‹œì‘
        </button>
        
        <button id="stopBtn" class="btn stop" onclick="stopScanner()" style="display:none;">
            â¹ï¸ ìŠ¤ìºë„ˆ ì¤‘ì§€
        </button>
        
        <!-- ì¹´ë©”ë¼ -->
        <div id="reader"></div>
        
        <!-- ê²°ê³¼ -->
        <div id="result">
            <strong>âœ… ì¸ì‹ ì„±ê³µ!</strong>
            <div id="resultText"></div>
            <button class="btn" onclick="restartScanner()">ë‹¤ì‹œ ìŠ¤ìº”</button>
        </div>
        
        <!-- ë””ë²„ê·¸ ì •ë³´ -->
        <div class="debug">
            <strong>ğŸ“Š ì‹¤ì‹œê°„ ë””ë²„ê·¸ ì •ë³´:</strong>
            <div id="debugInfo">
                - ëŒ€ê¸° ì¤‘...
            </div>
        </div>
    </div>

    <script>
        let html5QrCode = null;
        let isScanning = false;
        let scanCount = 0;
        let startTime = Date.now();
        let lastFormat = '';
        let debugInterval = null;
        
        // ìŠ¤ìºë„ˆ ì‹œì‘
        function startScanner() {
            console.log('Starting scanner...');
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'block';
            document.getElementById('statusIndicator').className = 'status-indicator scanning';
            document.getElementById('statusIndicator').innerHTML = 'ğŸ” ìŠ¤ìº” ì¤‘...';
            document.getElementById('result').classList.remove('show');
            
            // Html5Qrcode ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
            html5QrCode = new Html5Qrcode("reader");
            
            // 1. í¬ë§· ì„¤ì • (ì§„ì§œ íš¨ê³¼!)
            const formatSelect = document.getElementById('formatSelect').value;
            let formats = [];
            
            switch(formatSelect) {
                case 'qr':
                    formats = [Html5QrcodeSupportedFormats.QR_CODE];
                    lastFormat = 'QR Only';
                    break;
                case 'barcode':
                    formats = [
                        Html5QrcodeSupportedFormats.CODE_128,
                        Html5QrcodeSupportedFormats.CODE_39,
                        Html5QrcodeSupportedFormats.EAN_13,
                        Html5QrcodeSupportedFormats.EAN_8,
                        Html5QrcodeSupportedFormats.UPC_A,
                        Html5QrcodeSupportedFormats.UPC_E
                    ];
                    lastFormat = 'Barcode Only';
                    break;
                case 'code128':
                    formats = [Html5QrcodeSupportedFormats.CODE_128];
                    lastFormat = 'CODE-128 Only';
                    break;
                case 'ean':
                    formats = [
                        Html5QrcodeSupportedFormats.EAN_13,
                        Html5QrcodeSupportedFormats.EAN_8
                    ];
                    lastFormat = 'EAN Only';
                    break;
                default:
                    formats = [
                        Html5QrcodeSupportedFormats.QR_CODE,
                        Html5QrcodeSupportedFormats.CODE_128,
                        Html5QrcodeSupportedFormats.CODE_39,
                        Html5QrcodeSupportedFormats.EAN_13,
                        Html5QrcodeSupportedFormats.EAN_8
                    ];
                    lastFormat = 'All Formats';
            }
            
            // 2. FPS ì„¤ì • (ì§„ì§œ íš¨ê³¼!)
            const fps = parseInt(document.getElementById('fpsSelect').value);
            
            // 3. í•´ìƒë„ ì„¤ì • (ì§„ì§œ íš¨ê³¼!)
            const resolution = document.getElementById('resolutionSelect').value;
            let videoConstraints = { facingMode: "environment" };
            
            switch(resolution) {
                case 'low':
                    videoConstraints.width = { ideal: 640 };
                    videoConstraints.height = { ideal: 480 };
                    break;
                case 'medium':
                    videoConstraints.width = { ideal: 1280 };
                    videoConstraints.height = { ideal: 720 };
                    break;
                case 'high':
                    videoConstraints.width = { ideal: 1920 };
                    videoConstraints.height = { ideal: 1080 };
                    break;
            }
            
            // ì„¤ì • ì ìš©
            const config = {
                fps: fps,
                qrbox: { width: 250, height: 250 },  // ì´ê±´ ë‹¨ìˆœ UI
                formatsToSupport: formats  // ì´ê±´ ì§„ì§œ íš¨ê³¼!
            };
            
            // ìŠ¤ìºë„ˆ ì‹œì‘
            html5QrCode.start(
                videoConstraints,  // ì§„ì§œ í•´ìƒë„ ì„¤ì •!
                config,
                onScanSuccess,
                onScanFailure
            ).then(() => {
                console.log('Scanner started successfully');
                isScanning = true;
                startTime = Date.now();
                scanCount = 0;
                startDebugInfo();
            }).catch(err => {
                console.error('Failed to start scanner:', err);
                alert('ì¹´ë©”ë¼ ì‹œì‘ ì‹¤íŒ¨: ' + err);
                stopScanner();
            });
        }
        
        // ìŠ¤ìºë„ˆ ì¤‘ì§€
        function stopScanner() {
            console.log('Stopping scanner...');
            
            if (html5QrCode && isScanning) {
                html5QrCode.stop().then(() => {
                    console.log('Scanner stopped');
                    isScanning = false;
                    html5QrCode = null;
                }).catch(err => {
                    console.error('Failed to stop scanner:', err);
                });
            }
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('statusIndicator').className = 'status-indicator stopped';
            document.getElementById('statusIndicator').innerHTML = 'â¹ï¸ ì¤‘ì§€ë¨';
            
            stopDebugInfo();
        }
        
        // ìŠ¤ìº” ì„±ê³µ
        function onScanSuccess(decodedText, decodedResult) {
            const format = decodedResult.result.format.formatName;
            const elapsedTime = ((Date.now() - startTime) / 1000).toFixed(1);
            
            console.log('Scan success:', format, decodedText);
            
            document.getElementById('resultText').innerHTML = `
                <strong>í¬ë§·:</strong> ${format}<br>
                <strong>ê°’:</strong> ${decodedText}<br>
                <strong>ì¸ì‹ ì‹œê°„:</strong> ${elapsedTime}ì´ˆ<br>
                <strong>ìŠ¤ìº” íšŸìˆ˜:</strong> ${scanCount}íšŒ
            `;
            document.getElementById('result').classList.add('show');
            
            // ì§„ë™ í”¼ë“œë°±
            if (navigator.vibrate) {
                navigator.vibrate(200);
            }
            
            // ìë™ ì¤‘ì§€
            stopScanner();
        }
        
        // ìŠ¤ìº” ì‹¤íŒ¨ (ê³„ì† ì‹œë„)
        function onScanFailure(errorMessage) {
            scanCount++;
            // ì—ëŸ¬ëŠ” ë¬´ì‹œ (ê³„ì† ìŠ¤ìº” ì‹œë„)
        }
        
        // ë‹¤ì‹œ ìŠ¤ìº”
        function restartScanner() {
            document.getElementById('result').classList.remove('show');
            startScanner();
        }
        
        // ë””ë²„ê·¸ ì •ë³´ ì‹œì‘
        function startDebugInfo() {
            debugInterval = setInterval(() => {
                if (isScanning) {
                    const elapsedTime = ((Date.now() - startTime) / 1000).toFixed(1);
                    const scanRate = (scanCount / elapsedTime).toFixed(1);
                    
                    document.getElementById('debugInfo').innerHTML = `
                        - ìƒíƒœ: ${isScanning ? 'ìŠ¤ìº” ì¤‘' : 'ì¤‘ì§€ë¨'}<br>
                        - í™œì„± í¬ë§·: ${lastFormat}<br>
                        - ìŠ¤ìº” ì‹œë„: ${scanCount}íšŒ<br>
                        - ê²½ê³¼ ì‹œê°„: ${elapsedTime}ì´ˆ<br>
                        - ìŠ¤ìº” ì†ë„: ${scanRate}íšŒ/ì´ˆ<br>
                        - FPS ì„¤ì •: ${document.getElementById('fpsSelect').value}<br>
                        - í•´ìƒë„: ${document.getElementById('resolutionSelect').value}
                    `;
                }
            }, 500);
        }
        
        // ë””ë²„ê·¸ ì •ë³´ ì¤‘ì§€
        function stopDebugInfo() {
            if (debugInterval) {
                clearInterval(debugInterval);
                debugInterval = null;
            }
        }
        
        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
        window.addEventListener('beforeunload', () => {
            if (html5QrCode && isScanning) {
                html5QrCode.stop();
            }
        });
    </script>
</body>
</html>
