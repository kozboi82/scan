<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ì§„ì§œ ë°”ì½”ë“œ ìµœì í™” ìŠ¤ìºë„ˆ</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { 
            font-family: sans-serif; 
            padding: 10px;
            margin: 0;
            background: #f0f0f0;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }
        
        h2 { 
            color: #333; 
            text-align: center;
            margin-bottom: 10px;
        }
        
        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .info-box strong {
            color: #1976d2;
        }
        
        #reader { 
            width: 100%;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        /* ì»¤ìŠ¤í…€ ê°€ì´ë“œ ì˜¤ë²„ë ˆì´ */
        .custom-guide {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 100;
        }
        
        .barcode-guide {
            width: 300px;
            height: 80px;
            border: 3px dashed #ff5722;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 87, 34, 0.1);
        }
        
        .barcode-guide::before {
            content: "â”‚â”‚â”‚â”‚ â”‚â”‚ â”‚â”‚â”‚â”‚";
            color: #ff5722;
            font-size: 24px;
            font-family: monospace;
            opacity: 0.3;
        }
        
        .qr-guide {
            width: 200px;
            height: 200px;
            border: 3px dashed #4caf50;
            border-radius: 8px;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .settings {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .setting-row label {
            flex: 1;
            font-size: 14px;
        }
        
        .setting-row select,
        .setting-row input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        #result {
            margin-top: 20px;
            padding: 15px;
            background: #d4edda;
            border-radius: 8px;
            display: none;
        }
        
        #result.show {
            display: block;
        }
        
        .debug {
            margin-top: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .btn {
            padding: 12px 24px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: #1976d2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ”¬ ì§„ì§œ ë°”ì½”ë“œ ìµœì í™” ìŠ¤ìºë„ˆ</h2>
        
        <div class="info-box">
            <strong>ì§„ì‹¤:</strong> qrboxëŠ” ë‹¨ìˆœ ê°€ì´ë“œë¼ì¸ì…ë‹ˆë‹¤.<br>
            <strong>ì§„ì§œ ìµœì í™”:</strong> í¬ë§· ì„ íƒ, í•´ìƒë„, ìŠ¤ìº” ì£¼íŒŒìˆ˜
        </div>
        
        <!-- ì‹¤ì œ íš¨ê³¼ê°€ ìˆëŠ” ì„¤ì •ë“¤ -->
        <div class="settings">
            <h3>âš™ï¸ ì‹¤ì œ íš¨ê³¼ê°€ ìˆëŠ” ì„¤ì •</h3>
            
            <div class="setting-row">
                <label>ìŠ¤ìº” í¬ë§· (ì§„ì§œ íš¨ê³¼ âœ…)</label>
                <select id="formatSelect" onchange="updateSettings()">
                    <option value="all">ëª¨ë“  í¬ë§·</option>
                    <option value="qr">QR ì½”ë“œë§Œ</option>
                    <option value="barcode">ë°”ì½”ë“œë§Œ</option>
                    <option value="code128">CODE-128ë§Œ</option>
                    <option value="ean">EAN-13/8ë§Œ</option>
                </select>
            </div>
            
            <div class="setting-row">
                <label>ìŠ¤ìº” ì†ë„ FPS (ì§„ì§œ íš¨ê³¼ âœ…)</label>
                <select id="fpsSelect" onchange="updateSettings()">
                    <option value="5">5 FPS (ë°°í„°ë¦¬ ì ˆì•½)</option>
                    <option value="10" selected>10 FPS (ê· í˜•)</option>
                    <option value="15">15 FPS (ë¹ ë¥¸ ì¸ì‹)</option>
                    <option value="30">30 FPS (ìµœëŒ€ ì„±ëŠ¥)</option>
                </select>
            </div>
            
            <div class="setting-row">
                <label>ì¹´ë©”ë¼ í•´ìƒë„ (ì§„ì§œ íš¨ê³¼ âœ…)</label>
                <select id="resolutionSelect" onchange="updateSettings()">
                    <option value="low">ë‚®ìŒ (ë¹ ë¦„, ì €í’ˆì§ˆ)</option>
                    <option value="medium" selected>ì¤‘ê°„ (ê· í˜•)</option>
                    <option value="high">ë†’ìŒ (ëŠë¦¼, ê³ í’ˆì§ˆ)</option>
                    <option value="ultra">ìµœê³  (1080p+)</option>
                </select>
            </div>
            
            <div class="setting-row">
                <label>ê°€ì´ë“œ ë°•ìŠ¤ (ë‹¨ìˆœ UI ğŸ˜…)</label>
                <select id="boxSelect" onchange="updateGuide()">
                    <option value="square">ì •ì‚¬ê°í˜• (QRìš©)</option>
                    <option value="wide">ê°€ë¡œí˜• (ë°”ì½”ë“œìš©)</option>
                    <option value="none">ì—†ìŒ</option>
                </select>
            </div>
        </div>
        
        <!-- ì¹´ë©”ë¼ -->
        <div id="reader">
            <!-- ì»¤ìŠ¤í…€ ê°€ì´ë“œ ì˜¤ë²„ë ˆì´ -->
            <div class="custom-guide" id="customGuide" style="display:none;">
                <div class="barcode-guide" id="barcodeGuide"></div>
                <div class="qr-guide" id="qrGuide" style="display:none;"></div>
            </div>
        </div>
        
        <!-- ê²°ê³¼ -->
        <div id="result">
            <strong>ì¸ì‹ ì„±ê³µ!</strong>
            <div id="resultText"></div>
        </div>
        
        <!-- ë””ë²„ê·¸ ì •ë³´ -->
        <div class="debug">
            <strong>ğŸ“Š ì‹¤ì‹œê°„ ë””ë²„ê·¸ ì •ë³´:</strong>
            <div id="debugInfo">
                - ëŒ€ê¸° ì¤‘...
            </div>
        </div>
        
        <button class="btn" onclick="restartScanner()">ìŠ¤ìºë„ˆ ì¬ì‹œì‘</button>
    </div>

    <script>
        let html5QrCode;
        let scanCount = 0;
        let startTime = Date.now();
        let lastFormat = '';
        
        // ì´ˆê¸° ì‹œì‘
        window.onload = function() {
            startScanner();
            updateDebugInfo();
        };
        
        // ì§„ì§œ ì„¤ì • ì—…ë°ì´íŠ¸
        function updateSettings() {
            console.log('Settings changed, restarting scanner...');
            if (html5QrCode && html5QrCode.getState() === Html5QrcodeScannerState.SCANNING) {
                html5QrCode.stop().then(() => {
                    startScanner();
                });
            }
        }
        
        // UI ê°€ì´ë“œë§Œ ì—…ë°ì´íŠ¸ (ì‹¤ì œ ìŠ¤ìº”ì—ëŠ” ì˜í–¥ ì—†ìŒ)
        function updateGuide() {
            const boxType = document.getElementById('boxSelect').value;
            const customGuide = document.getElementById('customGuide');
            const barcodeGuide = document.getElementById('barcodeGuide');
            const qrGuide = document.getElementById('qrGuide');
            
            if (boxType === 'none') {
                customGuide.style.display = 'none';
            } else {
                customGuide.style.display = 'block';
                if (boxType === 'wide') {
                    barcodeGuide.style.display = 'flex';
                    qrGuide.style.display = 'none';
                } else {
                    barcodeGuide.style.display = 'none';
                    qrGuide.style.display = 'block';
                }
            }
        }
        
        // ìŠ¤ìºë„ˆ ì‹œì‘
        function startScanner() {
            html5QrCode = new Html5Qrcode("reader");
            
            // 1. í¬ë§· ì„¤ì • (ì§„ì§œ íš¨ê³¼!)
            const formatSelect = document.getElementById('formatSelect').value;
            let formats = [];
            
            switch(formatSelect) {
                case 'qr':
                    formats = [Html5QrcodeSupportedFormats.QR_CODE];
                    lastFormat = 'QR Only';
                    break;
                case 'barcode':
                    formats = [
                        Html5QrcodeSupportedFormats.CODE_128,
                        Html5QrcodeSupportedFormats.CODE_39,
                        Html5QrcodeSupportedFormats.EAN_13,
                        Html5QrcodeSupportedFormats.EAN_8,
                        Html5QrcodeSupportedFormats.UPC_A,
                        Html5QrcodeSupportedFormats.UPC_E
                    ];
                    lastFormat = 'Barcode Only';
                    break;
                case 'code128':
                    formats = [Html5QrcodeSupportedFormats.CODE_128];
                    lastFormat = 'CODE-128 Only';
                    break;
                case 'ean':
                    formats = [
                        Html5QrcodeSupportedFormats.EAN_13,
                        Html5QrcodeSupportedFormats.EAN_8
                    ];
                    lastFormat = 'EAN Only';
                    break;
                default:
                    formats = [
                        Html5QrcodeSupportedFormats.QR_CODE,
                        Html5QrcodeSupportedFormats.CODE_128,
                        Html5QrcodeSupportedFormats.CODE_39,
                        Html5QrcodeSupportedFormats.EAN_13,
                        Html5QrcodeSupportedFormats.EAN_8
                    ];
                    lastFormat = 'All Formats';
            }
            
            // 2. FPS ì„¤ì • (ì§„ì§œ íš¨ê³¼!)
            const fps = parseInt(document.getElementById('fpsSelect').value);
            
            // 3. í•´ìƒë„ ì„¤ì • (ì§„ì§œ íš¨ê³¼!)
            const resolution = document.getElementById('resolutionSelect').value;
            let videoConstraints = { facingMode: "environment" };
            
            switch(resolution) {
                case 'low':
                    videoConstraints.width = { ideal: 640 };
                    videoConstraints.height = { ideal: 480 };
                    break;
                case 'medium':
                    videoConstraints.width = { ideal: 1280 };
                    videoConstraints.height = { ideal: 720 };
                    break;
                case 'high':
                    videoConstraints.width = { ideal: 1920 };
                    videoConstraints.height = { ideal: 1080 };
                    break;
                case 'ultra':
                    videoConstraints.width = { min: 1920 };
                    videoConstraints.height = { min: 1080 };
                    break;
            }
            
            // ì„¤ì • ì ìš©
            const config = {
                fps: fps,
                qrbox: { width: 250, height: 250 },  // ì´ê±´ ë‹¨ìˆœ UI
                formatsToSupport: formats,  // ì´ê±´ ì§„ì§œ íš¨ê³¼!
                experimentalFeatures: {
                    useBarCodeDetectorIfSupported: true  // ë„¤ì´í‹°ë¸Œ API ì‚¬ìš©
                },
                aspectRatio: 16/9,
                showTorchButtonIfSupported: true  // í”Œë˜ì‹œ ë²„íŠ¼
            };
            
            // ìŠ¤ìºë„ˆ ì‹œì‘
            html5QrCode.start(
                videoConstraints,  // ì§„ì§œ í•´ìƒë„ ì„¤ì •!
                config,
                onScanSuccess,
                onScanFailure
            ).then(() => {
                console.log('Scanner started with:', {
                    formats: lastFormat,
                    fps: fps,
                    resolution: resolution
                });
                startTime = Date.now();
                scanCount = 0;
            }).catch(err => {
                console.error('Failed to start:', err);
            });
        }
        
        function onScanSuccess(decodedText, decodedResult) {
            const format = decodedResult.result.format.formatName;
            const elapsedTime = ((Date.now() - startTime) / 1000).toFixed(1);
            
            document.getElementById('resultText').innerHTML = `
                <strong>í¬ë§·:</strong> ${format}<br>
                <strong>ê°’:</strong> ${decodedText}<br>
                <strong>ì¸ì‹ ì‹œê°„:</strong> ${elapsedTime}ì´ˆ<br>
                <strong>ìŠ¤ìº” íšŸìˆ˜:</strong> ${scanCount}íšŒ
            `;
            document.getElementById('result').classList.add('show');
            
            // ì§„ë™ í”¼ë“œë°±
            if (navigator.vibrate) {
                navigator.vibrate(200);
            }
            
            html5QrCode.stop();
        }
        
        function onScanFailure(errorMessage) {
            scanCount++;
        }
        
        function restartScanner() {
            document.getElementById('result').classList.remove('show');
            if (html5QrCode && html5QrCode.getState() === Html5QrcodeScannerState.SCANNING) {
                html5QrCode.stop().then(() => {
                    startScanner();
                });
            } else {
                startScanner();
            }
        }
        
        // ë””ë²„ê·¸ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateDebugInfo() {
            setInterval(() => {
                const elapsedTime = ((Date.now() - startTime) / 1000).toFixed(1);
                const scanRate = (scanCount / elapsedTime).toFixed(1);
                
                document.getElementById('debugInfo').innerHTML = `
                    - í™œì„± í¬ë§·: ${lastFormat}<br>
                    - ìŠ¤ìº” ì‹œë„: ${scanCount}íšŒ<br>
                    - ê²½ê³¼ ì‹œê°„: ${elapsedTime}ì´ˆ<br>
                    - ìŠ¤ìº” ì†ë„: ${scanRate}íšŒ/ì´ˆ<br>
                    - FPS ì„¤ì •: ${document.getElementById('fpsSelect').value}<br>
                    - í•´ìƒë„: ${document.getElementById('resolutionSelect').value}
                `;
            }, 500);
        }
    </script>
</body>
</html>
